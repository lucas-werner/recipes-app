{"ast":null,"code":"var _jsxFileName = \"/home/lucaswerner/repositories/github-personal/recipes-app/src/pages/InProcessPage/index.js\";\nimport React, { useCallback, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { CheckBox, Card, FavoriteIcon, ShareIcon, LinkBtn } from '../../components';\nimport { fetchDrinkApi, handleDrinksData } from '../../services/APIs/DRINKS_API';\nimport { fetchFoodsApi, handleFoodsData } from '../../services/APIs/FOODS_API';\nimport useRequisition from '../../hooks/requisition';\nimport useLocalStorage from '../../hooks/localStorage';\nimport { getInProgress, setInProgress, rmInProgress, setDoneRecipeStorage } from '../../services/APIs/APIlocalStorage';\n\nconst fetchAPI = async (type, id, setRecipe) => {\n  if (type === 'food') {\n    return fetchFoodsApi(`lookup.php?i=${id}`).then(({\n      meals\n    }) => setRecipe(handleFoodsData(meals[0])));\n  } else if (type === 'drink') {\n    return fetchDrinkApi(`lookup.php?i=${id}`).then(({\n      drinks\n    }) => setRecipe(handleDrinksData(drinks[0])));\n  }\n\n  return Promise.reject(`Type ${type} isn't valid`);\n};\n\nconst endRecipe = (type, recipe) => () => {\n  rmInProgress(type, recipe.id);\n  setDoneRecipeStorage(recipe, type);\n};\n\nconst changeCheckBox = (usedIng, checked, value) => {\n  if (checked) return [...usedIng, Number(value)].sort((a, b) => a - b);\n  return usedIng.filter(usedIngredient => usedIngredient !== Number(value));\n};\n\nconst setInProgressUse = (type, id) => newUsed => setInProgress(type, id, newUsed);\n\nfunction InProcessPage({\n  id,\n  type\n}) {\n  const [recipe, setRecipe] = useState(null);\n  const [{\n    loading,\n    error\n  }] = useRequisition(useCallback(() => fetchAPI(type, id, setRecipe), [type, id, setRecipe]));\n  const [usedIngredients, setUsedIngredients] = useLocalStorage(getInProgress(type)[id] || [], setInProgressUse(type, id));\n  const toggleCheckbox = useCallback(({\n    target: {\n      value,\n      checked\n    }\n  }) => {\n    setUsedIngredients(usedIng => changeCheckBox(usedIng, checked, value));\n  }, [setUsedIngredients]);\n  if (error) return /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 21\n    }\n  }, \"Aconteceu algo errado em detalhes de bebidas em progresso\");\n  if (loading) return /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 23\n    }\n  }, \"Carregando detalhes de bebidas em progresso...\");\n  const {\n    name,\n    srcImage,\n    category,\n    ingredients,\n    instructions,\n    isAlcoholic\n  } = recipe;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Card, {\n    srcImage: srcImage,\n    name: name,\n    testid: {\n      title: 'recipe-title',\n      img: 'recipe-photo'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(ShareIcon, {\n    textToCopy: `${window.location.href.slice(0, -12)}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(FavoriteIcon, {\n    recipe: recipe,\n    type: type,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    \"data-testid\": \"recipe-category\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }\n  }, isAlcoholic || category), /*#__PURE__*/React.createElement(\"p\", {\n    \"data-testid\": \"instructions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 7\n    }\n  }, instructions), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }\n  }, ingredients && ingredients.map(({\n    ingredient\n  }, index) => /*#__PURE__*/React.createElement(CheckBox, {\n    key: ingredient,\n    checked: usedIngredients.some(used => used === index),\n    index: index,\n    item: ingredient,\n    handleChange: toggleCheckbox,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(LinkBtn, {\n    disabled: usedIngredients.length < ingredients.length,\n    onClick: endRecipe(type, recipe),\n    testid: \"finish-recipe-btn\",\n    text: \"Finalizar receita\",\n    to: \"/receitas-feitas\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }\n  }));\n}\n\nInProcessPage.propTypes = {\n  id: PropTypes.number.isRequired,\n  type: PropTypes.oneOf(['food', 'drink']).isRequired\n};\nexport default InProcessPage;","map":{"version":3,"sources":["/home/lucaswerner/repositories/github-personal/recipes-app/src/pages/InProcessPage/index.js"],"names":["React","useCallback","useState","PropTypes","CheckBox","Card","FavoriteIcon","ShareIcon","LinkBtn","fetchDrinkApi","handleDrinksData","fetchFoodsApi","handleFoodsData","useRequisition","useLocalStorage","getInProgress","setInProgress","rmInProgress","setDoneRecipeStorage","fetchAPI","type","id","setRecipe","then","meals","drinks","Promise","reject","endRecipe","recipe","changeCheckBox","usedIng","checked","value","Number","sort","a","b","filter","usedIngredient","setInProgressUse","newUsed","InProcessPage","loading","error","usedIngredients","setUsedIngredients","toggleCheckbox","target","name","srcImage","category","ingredients","instructions","isAlcoholic","title","img","window","location","href","slice","map","ingredient","index","some","used","length","propTypes","number","isRequired","oneOf"],"mappings":"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","sourcesContent":["import React, { useCallback, useState } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { CheckBox, Card, FavoriteIcon, ShareIcon, LinkBtn } from '../../components';\n\nimport { fetchDrinkApi, handleDrinksData } from '../../services/APIs/DRINKS_API';\nimport { fetchFoodsApi, handleFoodsData } from '../../services/APIs/FOODS_API';\n\nimport useRequisition from '../../hooks/requisition';\nimport useLocalStorage from '../../hooks/localStorage';\n\nimport {\n  getInProgress,\n  setInProgress,\n  rmInProgress,\n  setDoneRecipeStorage,\n} from '../../services/APIs/APIlocalStorage';\n\nconst fetchAPI = async (type, id, setRecipe) => {\n  if (type === 'food') {\n    return fetchFoodsApi(`lookup.php?i=${id}`)\n      .then(({ meals }) => setRecipe(handleFoodsData(meals[0])));\n  } else if (type === 'drink') {\n    return fetchDrinkApi(`lookup.php?i=${id}`)\n      .then(({ drinks }) => setRecipe(handleDrinksData(drinks[0])));\n  } return Promise.reject(`Type ${type} isn't valid`);\n};\n\nconst endRecipe = (type, recipe) => () => {\n  rmInProgress(type, recipe.id);\n  setDoneRecipeStorage(recipe, type);\n};\n\nconst changeCheckBox = (usedIng, checked, value) => {\n  if (checked) return [...usedIng, Number(value)].sort((a, b) => a - b);\n  return usedIng.filter((usedIngredient) => usedIngredient !== Number(value));\n};\n\nconst setInProgressUse = (type, id) => (newUsed) => setInProgress(type, id, newUsed);\n\nfunction InProcessPage({ id, type }) {\n  const [recipe, setRecipe] = useState(null);\n  const [{ loading, error }] = useRequisition(\n    useCallback(() => fetchAPI(type, id, setRecipe), [type, id, setRecipe]),\n  );\n  const [usedIngredients, setUsedIngredients] = useLocalStorage(\n    getInProgress(type)[id] || [],\n    setInProgressUse(type, id),\n  );\n\n  const toggleCheckbox = useCallback(({ target: { value, checked } }) => {\n    setUsedIngredients((usedIng) => changeCheckBox(usedIng, checked, value));\n  }, [setUsedIngredients]);\n\n  if (error) return <h1>Aconteceu algo errado em detalhes de bebidas em progresso</h1>;\n  if (loading) return <h1>Carregando detalhes de bebidas em progresso...</h1>;\n\n  const { name, srcImage, category, ingredients, instructions, isAlcoholic } = recipe;\n  return (\n    <div>\n      <Card\n        srcImage={srcImage}\n        name={name}\n        testid={{ title: 'recipe-title', img: 'recipe-photo' }}\n      />\n      <ShareIcon textToCopy={`${window.location.href.slice(0, -12)}`} />\n      <FavoriteIcon recipe={recipe} type={type} />\n      <p data-testid=\"recipe-category\">{isAlcoholic || category}</p>\n      <p data-testid=\"instructions\">{instructions}</p>\n      <div>\n        {ingredients && ingredients.map(({ ingredient }, index) => (\n          <CheckBox\n            key={ingredient}\n            checked={usedIngredients.some((used) => used === index)}\n            index={index}\n            item={ingredient}\n            handleChange={toggleCheckbox}\n          />\n        ))}\n      </div>\n      <LinkBtn\n        disabled={usedIngredients.length < ingredients.length}\n        onClick={endRecipe(type, recipe)}\n        testid=\"finish-recipe-btn\"\n        text=\"Finalizar receita\"\n        to=\"/receitas-feitas\"\n      />\n    </div>\n  );\n}\n\nInProcessPage.propTypes = {\n  id: PropTypes.number.isRequired,\n  type: PropTypes.oneOf(['food', 'drink']).isRequired,\n};\n\nexport default InProcessPage;\n"]},"metadata":{},"sourceType":"module"}
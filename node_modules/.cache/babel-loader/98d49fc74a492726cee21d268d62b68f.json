{"ast":null,"code":"import _slicedToArray from\"/home/lucaswerner/repositories/github-personal/recipes-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"/home/lucaswerner/repositories/github-personal/recipes-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/lucaswerner/repositories/github-personal/recipes-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/lucaswerner/repositories/github-personal/recipes-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useCallback,useState}from'react';import{CheckBox,Card,FavoriteIcon,ShareIcon,LinkBtn}from'../../components';import{fetchDrinkApi,handleDrinksData}from'../../services/APIs/DRINKS_API';import{fetchFoodsApi,handleFoodsData}from'../../services/APIs/FOODS_API';import useRequisition from'../../hooks/requisition';import useLocalStorage from'../../hooks/localStorage';import{getInProgress,setInProgress,rmInProgress,setDoneRecipeStorage}from'../../services/APIs/APIlocalStorage';var fetchAPI=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(type,id,setRecipe){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(type==='food')){_context.next=4;break;}return _context.abrupt(\"return\",fetchFoodsApi(\"lookup.php?i=\".concat(id)).then(function(_ref2){var meals=_ref2.meals;return setRecipe(handleFoodsData(meals[0]));}));case 4:if(!(type==='drink')){_context.next=6;break;}return _context.abrupt(\"return\",fetchDrinkApi(\"lookup.php?i=\".concat(id)).then(function(_ref3){var drinks=_ref3.drinks;return setRecipe(handleDrinksData(drinks[0]));}));case 6:return _context.abrupt(\"return\",Promise.reject(\"Type \".concat(type,\" isn't valid\")));case 7:case\"end\":return _context.stop();}}},_callee);}));return function fetchAPI(_x,_x2,_x3){return _ref.apply(this,arguments);};}();var endRecipe=function endRecipe(type,recipe){return function(){rmInProgress(type,recipe.id);setDoneRecipeStorage(recipe,type);};};var changeCheckBox=function changeCheckBox(usedIng,checked,value){if(checked)return[].concat(_toConsumableArray(usedIng),[Number(value)]).sort(function(a,b){return a-b;});return usedIng.filter(function(usedIngredient){return usedIngredient!==Number(value);});};var setInProgressUse=function setInProgressUse(type,id){return function(newUsed){return setInProgress(type,id,newUsed);};};function InProcessPage(_ref4){var id=_ref4.id,type=_ref4.type;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),recipe=_useState2[0],setRecipe=_useState2[1];var _useRequisition=useRequisition(useCallback(function(){return fetchAPI(type,id,setRecipe);},[type,id,setRecipe])),_useRequisition2=_slicedToArray(_useRequisition,1),_useRequisition2$=_useRequisition2[0],loading=_useRequisition2$.loading,error=_useRequisition2$.error;var _useLocalStorage=useLocalStorage(getInProgress(type)[id]||[],setInProgressUse(type,id)),_useLocalStorage2=_slicedToArray(_useLocalStorage,2),usedIngredients=_useLocalStorage2[0],setUsedIngredients=_useLocalStorage2[1];var toggleCheckbox=useCallback(function(_ref5){var _ref5$target=_ref5.target,value=_ref5$target.value,checked=_ref5$target.checked;setUsedIngredients(function(usedIng){return changeCheckBox(usedIng,checked,value);});},[setUsedIngredients]);if(error)return/*#__PURE__*/React.createElement(\"h1\",null,\"Aconteceu algo errado em detalhes de bebidas em progresso\");if(loading)return/*#__PURE__*/React.createElement(\"h1\",null,\"Carregando detalhes de bebidas em progresso...\");var name=recipe.name,srcImage=recipe.srcImage,category=recipe.category,ingredients=recipe.ingredients,instructions=recipe.instructions,isAlcoholic=recipe.isAlcoholic;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Card,{srcImage:srcImage,name:name,testid:{title:'recipe-title',img:'recipe-photo'}}),/*#__PURE__*/React.createElement(ShareIcon,{textToCopy:\"\".concat(window.location.href.slice(0,-12))}),/*#__PURE__*/React.createElement(FavoriteIcon,{recipe:recipe,type:type}),/*#__PURE__*/React.createElement(\"p\",{\"data-testid\":\"recipe-category\"},isAlcoholic||category),/*#__PURE__*/React.createElement(\"p\",{\"data-testid\":\"instructions\"},instructions),/*#__PURE__*/React.createElement(\"div\",null,ingredients&&ingredients.map(function(_ref6,index){var ingredient=_ref6.ingredient;return/*#__PURE__*/React.createElement(CheckBox,{key:ingredient,checked:usedIngredients.some(function(used){return used===index;}),index:index,item:ingredient,handleChange:toggleCheckbox});})),/*#__PURE__*/React.createElement(LinkBtn,{disabled:usedIngredients.length<ingredients.length,onClick:endRecipe(type,recipe),testid:\"finish-recipe-btn\",text:\"Finalizar receita\",to:\"/receitas-feitas\"}));}export default InProcessPage;","map":{"version":3,"sources":["/home/lucaswerner/repositories/github-personal/recipes-app/src/pages/InProcessPage/index.js"],"names":["React","useCallback","useState","CheckBox","Card","FavoriteIcon","ShareIcon","LinkBtn","fetchDrinkApi","handleDrinksData","fetchFoodsApi","handleFoodsData","useRequisition","useLocalStorage","getInProgress","setInProgress","rmInProgress","setDoneRecipeStorage","fetchAPI","type","id","setRecipe","then","meals","drinks","Promise","reject","endRecipe","recipe","changeCheckBox","usedIng","checked","value","Number","sort","a","b","filter","usedIngredient","setInProgressUse","newUsed","InProcessPage","loading","error","usedIngredients","setUsedIngredients","toggleCheckbox","target","name","srcImage","category","ingredients","instructions","isAlcoholic","title","img","window","location","href","slice","map","index","ingredient","some","used","length"],"mappings":"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","sourcesContent":["import React, { useCallback, useState } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { CheckBox, Card, FavoriteIcon, ShareIcon, LinkBtn } from '../../components';\n\nimport { fetchDrinkApi, handleDrinksData } from '../../services/APIs/DRINKS_API';\nimport { fetchFoodsApi, handleFoodsData } from '../../services/APIs/FOODS_API';\n\nimport useRequisition from '../../hooks/requisition';\nimport useLocalStorage from '../../hooks/localStorage';\n\nimport {\n  getInProgress,\n  setInProgress,\n  rmInProgress,\n  setDoneRecipeStorage,\n} from '../../services/APIs/APIlocalStorage';\n\nconst fetchAPI = async (type, id, setRecipe) => {\n  if (type === 'food') {\n    return fetchFoodsApi(`lookup.php?i=${id}`)\n      .then(({ meals }) => setRecipe(handleFoodsData(meals[0])));\n  } else if (type === 'drink') {\n    return fetchDrinkApi(`lookup.php?i=${id}`)\n      .then(({ drinks }) => setRecipe(handleDrinksData(drinks[0])));\n  } return Promise.reject(`Type ${type} isn't valid`);\n};\n\nconst endRecipe = (type, recipe) => () => {\n  rmInProgress(type, recipe.id);\n  setDoneRecipeStorage(recipe, type);\n};\n\nconst changeCheckBox = (usedIng, checked, value) => {\n  if (checked) return [...usedIng, Number(value)].sort((a, b) => a - b);\n  return usedIng.filter((usedIngredient) => usedIngredient !== Number(value));\n};\n\nconst setInProgressUse = (type, id) => (newUsed) => setInProgress(type, id, newUsed);\n\nfunction InProcessPage({ id, type }) {\n  const [recipe, setRecipe] = useState(null);\n  const [{ loading, error }] = useRequisition(\n    useCallback(() => fetchAPI(type, id, setRecipe), [type, id, setRecipe]),\n  );\n  const [usedIngredients, setUsedIngredients] = useLocalStorage(\n    getInProgress(type)[id] || [],\n    setInProgressUse(type, id),\n  );\n\n  const toggleCheckbox = useCallback(({ target: { value, checked } }) => {\n    setUsedIngredients((usedIng) => changeCheckBox(usedIng, checked, value));\n  }, [setUsedIngredients]);\n\n  if (error) return <h1>Aconteceu algo errado em detalhes de bebidas em progresso</h1>;\n  if (loading) return <h1>Carregando detalhes de bebidas em progresso...</h1>;\n\n  const { name, srcImage, category, ingredients, instructions, isAlcoholic } = recipe;\n  return (\n    <div>\n      <Card\n        srcImage={srcImage}\n        name={name}\n        testid={{ title: 'recipe-title', img: 'recipe-photo' }}\n      />\n      <ShareIcon textToCopy={`${window.location.href.slice(0, -12)}`} />\n      <FavoriteIcon recipe={recipe} type={type} />\n      <p data-testid=\"recipe-category\">{isAlcoholic || category}</p>\n      <p data-testid=\"instructions\">{instructions}</p>\n      <div>\n        {ingredients && ingredients.map(({ ingredient }, index) => (\n          <CheckBox\n            key={ingredient}\n            checked={usedIngredients.some((used) => used === index)}\n            index={index}\n            item={ingredient}\n            handleChange={toggleCheckbox}\n          />\n        ))}\n      </div>\n      <LinkBtn\n        disabled={usedIngredients.length < ingredients.length}\n        onClick={endRecipe(type, recipe)}\n        testid=\"finish-recipe-btn\"\n        text=\"Finalizar receita\"\n        to=\"/receitas-feitas\"\n      />\n    </div>\n  );\n}\n\nInProcessPage.propTypes = {\n  id: PropTypes.number.isRequired,\n  type: PropTypes.oneOf(['food', 'drink']).isRequired,\n};\n\nexport default InProcessPage;\n"]},"metadata":{},"sourceType":"module"}